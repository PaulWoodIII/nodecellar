

<div class="row-fluid status-bar">
    <div class="span12">
        <div class="alert alert-success" style="display: none">
            <b>Success!</b> Image saved successfully
        </div>
    </div>
</div>
<!-- TO DO Take out the styles -->
<div class="row-fluid" style="margin-bottom:20px;">
	<div class="span8">
		<form id="uploadform">
			<legend>Upload an Image</legend>
			<input id="fileupload" type="file" name="imagefile" data-url="imagefiles" >
			<button type="#" class="btn btn-primary uploadfile" style="display: none">Upload</button>
			<div id="progress">
			    <div class="bar" style="width: 0%;"></div>
			</div>		
		</form>
	</div>
	
    <div class="span4">
        <div class="well" style="min-height: 180px; width: 180px;text-align: center;width:50%;margin: 0px auto;">
            <p><img id="uploadedimage" width="180" src=""/></p>
        </div>
    </div>
	
	<script>
	$(function () {
	    $('#fileupload').fileupload({
	        dataType: 'json',
		    progressall: function (e, data) {
		        var progress = parseInt(data.loaded / data.total * 100, 10);
		        $('#progress .bar').css(
		            'width',
		            progress + '%'
		        );
		    },
			add: function (e, data) {
				console.log('added');
	            data.context = $('.uploadfile')
					.css('display','block')
	                .click(function () {
						utils.showAlert('Uploading','...', 'alert-warning');
						var jqXHR = data.submit()
							.success(function (result, textStatus, jqXHR) {
								$('#imagefileId').val(result.id);								
								$('#uploadedimage').attr("src",'/imagefiles/' + result.id + '/data');
								data.context = $('.uploadfile').css('display','none');
								utils.showAlert('Success','the file uploaded successfully','alert-success');

								// TO DO:
								// Tell Backbone about the change!

								// window.ImagePostView.changePost(this);
				       	 	})
							.error(function (jqXHR, textStatus, errorThrown){
								 utils.showAlert('Error','...', 'alert-error');
							});
	                });
	        }
	    });
	});
	</script>
</div>


<div class="row-fluid">
  <div class="span12">
	<form class="form-horizontal imagepost-form" >
	    <fieldset>
			<div class="well">						
				<div class="control-group">
						
		            <legend>About this Image</legend>
		            
					<br/>
					
                    <label for="imagefileId" class="control-label">File Id:</label>
					<div class="controls">
						<input id="imagefileId" name="imagefileId" type="text" value="<%= imagepost.imagefileid === null ? '' : imagepost.imagefileid %>" style="" disabled/>
					</div>
					
					<br />
											
                    <label for="imagepostId" class="control-label">Id:</label>
                    <div class="controls">
                        <input id="imagepostId" name="imagepostId" type="text" value="<%= imagepost._id === null ? '' : imagepost._id %>" disabled/>
                    </div>
						
					<br />
						
					<label for="filename" class="control-label">filename:</label>
					<div class="controls">
						<input type="text" id="filename" name="filename" value="<%= imagepost.filename === null ? '' : imagepost.filename %>" >
					</div>
						
					<br />
	
				</div>	
			    <div class="form-actions">
			        <a href="#" class="btn btn-primary save">Save</a>
			        <a href="#" class="btn delete">Delete</a>
			    </div>
			</div>
		</fieldset>		
	</form>
  </div>	
</div>

